<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Catch 20 to Win - Space Theme</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body {
    margin: 0;
    background: linear-gradient(#000010, #0a0a2a);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: 'Trebuchet MS', sans-serif;
    color: #fff;
    flex-direction: column;
    overflow: hidden;
  }
  canvas {
    background: radial-gradient(circle at top, #111, #000);
    border: 2px solid #0ff;
    border-radius: 12px;
    touch-action: none;
    box-shadow: 0 0 20px #0ff;
  }
  #overlay {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%,-50%);
    color: #0ff;
    font-size: 26px;
    text-align: center;
    display: none;
    text-shadow: 0 0 12px #0ff;
  }
  .controls {
    display: flex;
    gap: 20px;
    margin-top: 12px;
  }
  .btn {
    background: #111;
    border: 2px solid #0ff;
    color: #0ff;
    padding: 14px 24px;
    border-radius: 10px;
    font-size: 20px;
    user-select: none;
    box-shadow: 0 0 8px #0ff;
  }
  .btn:active {
    background: #0ff;
    color: #111;
  }
</style>
</head>
<body>
<canvas id="game" width="400" height="600"></canvas>
<div id="overlay"></div>
<div class="controls">
  <div class="btn" id="leftBtn">‚óÄ</div>
  <div class="btn" id="rightBtn">‚ñ∂</div>
  <div class="btn" id="restartBtn">‚ü≥</div>
  <div class="btn" id="chatHistoryBtn">üí¨ Chat History</div>
</div>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const overlay = document.getElementById("overlay");
const leftBtn = document.getElementById("leftBtn");
const rightBtn = document.getElementById("rightBtn");
const restartBtn = document.getElementById("restartBtn");
const chatHistoryBtn = document.getElementById("chatHistoryBtn");

// player name
const playerName = "Pankaj";

// player (triangle spaceship)
const player = {x: 160, y: 560, w: 80, h: 20, speed: 5};

// stars
let stars = [];
let score = 0;
let missed = 0;
let running = true;
let spawnInterval = 1200;

function spawnStar() {
  const x = Math.random() * (canvas.width - 20);
  const speed = 3 + score*0.2; // harder as score increases
  stars.push({x, y: -20, size: 20, speed});
}

function resetGame() {
  stars = [];
  score = 0;
  missed = 0;
  running = true;
  spawnInterval = 1200;
  overlay.style.display = "none";
  player.x = 160;
  loop();
}

function endGame(message) {
  running = false;
  overlay.innerHTML = playerName + ", " + message + "<br><br>Press ‚ü≥ or Space to Restart";
  overlay.style.display = "block";
}

function update() {
  if (keys["ArrowLeft"] || keys["a"] || touchLeft) player.x -= player.speed;
  if (keys["ArrowRight"] || keys["d"] || touchRight) player.x += player.speed;
  if (player.x < 0) player.x = 0;
  if (player.x + player.w > canvas.width) player.x = canvas.width - player.w;

  for (let i = stars.length - 1; i >= 0; i--) {
    let s = stars[i];
    s.y += s.speed;
    if (s.y > canvas.height) { stars.splice(i,1); missed++; }
    if (
      s.x < player.x + player.w &&
      s.x + s.size > player.x &&
      s.y < player.y + player.h &&
      s.y + s.size > player.y
    ) { stars.splice(i,1); score++; }
  }

  if (score >= 20) endGame("üöÄ You Win!");
  if (missed >= 5) endGame("üíÄ You Lose!");
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle = "rgba(0,255,255,0.05)";
  ctx.font = "100px sans-serif";
  ctx.fillText(playerName, 20, canvas.height/2 + 50);

  ctx.fillStyle = "#0ff";
  ctx.shadowColor = "#0ff";
  ctx.shadowBlur = 20;
  ctx.beginPath();
  ctx.moveTo(player.x + player.w/2, player.y);
  ctx.lineTo(player.x, player.y + player.h);
  ctx.lineTo(player.x + player.w, player.y + player.h);
  ctx.closePath();
  ctx.fill();
  ctx.shadowBlur = 0;

  ctx.fillStyle = "#ff0";
  for (let s of stars) { drawStar(s.x+10, s.y+10, 5, s.size/2, s.size/4); }

  ctx.fillStyle = "#0ff";
  ctx.font = "18px sans-serif";
  ctx.fillText("‚≠ê Score: " + score, 10, 20);
  ctx.fillText("‚ùå Missed: " + missed, 280, 20);
}

function drawStar(cx, cy, spikes, outerRadius, innerRadius){
  let rot = Math.PI / 2 * 3;
  let x = cx, y = cy;
  let step = Math.PI / spikes;
  ctx.beginPath();
  ctx.moveTo(cx, cy - outerRadius)
  for(let i = 0; i < spikes; i++){
    x = cx + Math.cos(rot) * outerRadius;
    y = cy + Math.sin(rot) * outerRadius;
    ctx.lineTo(x, y)
    rot += step
    x = cx + Math.cos(rot) * innerRadius;
    y = cy + Math.sin(rot) * innerRadius;
    ctx.lineTo(x, y)
    rot += step
  }
  ctx.lineTo(cx, cy - outerRadius);
  ctx.closePath();
  ctx.fill();
}

function loop() {
  if (!running) return;
  update();
  draw();
  requestAnimationFrame(loop);
}

setInterval(()=>{ if(running) spawnStar(); }, spawnInterval);

let keys = {};
let touchLeft = false;
let touchRight = false;

window.addEventListener("keydown", e=>{
  keys[e.key] = true;
  if (!running && e.code === "Space") resetGame();
});
window.addEventListener("keyup", e=> keys[e.key] = false);

leftBtn.addEventListener("touchstart", ()=> touchLeft = true);
leftBtn.addEventListener("touchend", ()=> touchLeft = false);
rightBtn.addEventListener("touchstart", ()=> touchRight = true);
rightBtn.addEventListener("touchend", ()=> touchRight = false);
restartBtn.addEventListener("click", ()=> resetGame());

leftBtn.addEventListener("mousedown", ()=> touchLeft = true);
leftBtn.addEventListener("mouseup", ()=> touchLeft = false);
rightBtn.addEventListener("mousedown", ()=> touchRight = true);
rightBtn.addEventListener("mouseup", ()=> touchRight = false);

// Chat History button
chatHistoryBtn.addEventListener("click", () => {
  window.open("https://chatgpt.com/share/68d22c9e-0538-8007-9c32-c615a0f1238b", "_blank");
});

overlay.innerHTML = "Welcome " + playerName + "!<br>Catch 20 stars to win!";
overlay.style.display = "block";
setTimeout(() => { overlay.style.display = "none"; loop(); }, 2000);

</script>
</body>
</html>
